from __future__ import annotations

from typing import Any


# NOTE: Minimal, dependency-free i18n.
# - Source language is French.
# - English translations are provided where keys exist.
# - Unknown keys fall back to the original string.

_TRANSLATIONS_EN: dict[str, str] = {
    # Nav / global
    "Dashboard": "Dashboard",
    "Communauté": "Community",
    "Activités": "Activities",
    "Santé": "Health",
    "Entraînement": "Training",
    "Profil": "Profile",
    "Admin": "Admin",
    "Connexion": "Login",
    "Déconnexion": "Logout",
    "Coach": "Coach",
    "Voir dashboard": "View dashboard",
    "Ajouter athlète": "Add athlete",
    "Retirer athlète": "Remove athlete",
    "Accède aux dashboards de la communauté.": "Access the community dashboards.",
    "Dashboards": "Dashboards",
    "Aucun compte.": "No accounts.",

    # Home / auth
    "Bienvenue": "Welcome",
    "Connecté en tant que": "Signed in as",
    "Aller au dashboard": "Go to dashboard",
    "Email Garmin + PIN (app).": "Garmin email + app PIN.",
    "Email": "Email",
    "PIN": "PIN",
    "Se connecter": "Sign in",
    "Inscription": "Sign up",
    "Ton compte app utilise le même email que Garmin.": "Your app account uses the same email as Garmin.",
    "Pseudo": "Username",
    "S'inscrire": "Create account",

    # Training UI
    "Calendrier": "Calendar",
    "Planificateur de séance": "Workout planner",
    "Séance type": "Preset",
    "— Choisir un modèle —": "— Choose a preset —",
    "Appliquer": "Apply",
    "Pré-remplit les champs (modifiable ensuite).": "Pre-fills fields (editable afterwards).",
    "Titre": "Title",
    "Date": "Date",
    "Sport": "Sport",
    "Distance (km)": "Distance (km)",
    "Description courte": "Short description",
    "Contenu": "Content",
    "Remarques": "Notes",
    "Ajouter": "Add",
    "Compétition": "Race",
    "Nom": "Name",
    "Lieu": "Location",
    "Prochains entraînements": "Upcoming trainings",
    "Prochaines compétitions": "Upcoming races",
    "Supprimer": "Delete",
    "← Retour au calendrier": "← Back to calendar",

    # Admin UI
    "Gestion des comptes: réinitialiser PIN, supprimer données, supprimer compte.": "Account management: reset PIN, delete data, delete account.",
    "Comptes": "Accounts",
    "Mettre à jour": "Update",
    "Réinitialiser PIN": "Reset PIN",
    "Supprimer données": "Delete data",
    "Supprimer compte": "Delete account",
    "Nouveau PIN (optionnel)": "New PIN (optional)",
    "(vide = générer un PIN)": "(empty = generate a PIN)",

    # Profile
    "Règle ta FC max, ta VMA, et tes zones de fréquence cardiaque.": "Set your max HR, VO2max speed, and heart rate zones.",
    "Retour dashboard": "Back to dashboard",
    "Records (course à pied)": "Records (running)",
    "Meilleure performance par distance, basée sur les activités proches de la distance cible.": "Best performance per distance, based on activities close to the target distance.",
    "Temps": "Time",
    "Activité": "Activity",
    "Voir activité": "View activity",
    "Aucune activité de course détectée.": "No running activity detected.",
    "À venir": "Upcoming",
    "Aucun entraînement planifié.": "No training scheduled.",
    "Aucune compétition à venir.": "No upcoming races.",
    "Paramètres": "Settings",
    "Langue": "Language",
    "Français": "French",
    "Anglais": "English",
    "FC max (bpm)": "Max HR (bpm)",
    "VMA (km/h)": "VO2max speed (km/h)",
    "Zones FC (bpm)": "HR Zones (bpm)",
    "Saisis les seuils max de Z1..Z4. Z5 = FC max.": "Enter the max thresholds for Z1..Z4. Z5 = max HR.",
    "Z1 max": "Z1 max",
    "Z2 max": "Z2 max",
    "Z3 max": "Z3 max",
    "Z4 max": "Z4 max",
    "Enregistrer": "Save",
    
    # Dashboard / index
    "Tous sports — {period}": "All sports — {period}",
    "Vue: {user}": "Viewing: {user}",
    "Période": "Period",
    "Semaine": "Week",
    "Mois": "Month",
    "Année": "Year",
    "Sport (graphiques)": "Sport (charts)",
    "Tous": "All",
    "Régler zones": "Set zones",
    "Prochainements": "Upcoming",
    "Aucune compétition planifiée.": "No races planned.",
    "Compte rendu": "Summary",
    "Conseil: ajuste tes zones dans Profil pour fiabiliser les répartitions.": "Tip: adjust your zones in Profile to improve accuracy.",
    "Par sport": "By sport",
    "Aucune activité sur la période.": "No activity in this period.",
    "Séances": "Sessions",
    "Distance": "Distance",
    "Charge": "Load",
    "Graphiques": "Charts",
    "Zones de fréquence cardiaque": "Heart rate zones",
    "Définis ta FC max et tes zones dans Profil.": "Set your max HR and zones in Profile.",
    "Zones estimées (FC max observée: {fcmax}). Règle Profil pour fiabiliser.": "Estimated zones (observed max HR: {fcmax}). Configure Profile for accuracy.",
    "Répartition (temps, %)": "Distribution (time, %)",
    "Objectif (référence)": "Target (reference)",

    # Activity page
    "Activité non trouvée.": "Activity not found.",
    "Mettre à jour": "Update",
    "Générer graphiques": "Generate charts",
    "Filtre": "Filter",
    "Toutes": "All",
    "Récentes": "Recent",
    "Clique sur 'Mettre à jour' pour synchroniser avec Garmin Connect.": "Click 'Update' to sync with Garmin Connect.",
    "Aucune activité.": "No activities.",
    "Créer un entraînement planifié à partir de cette activité.": "Create a planned training from this activity.",
    "Entraînement planifié": "Planned training",
    "Réalisé": "Done",
    "Ressenti": "Feeling",
    "Remarques après séance": "Post-session notes",
    "Clique sur \"Mettre à jour\" dans la page Activités pour synchroniser les détails.": "Click \"Update\" on the Activities page to sync details.",
    
    # Health page
    "Vue d'ensemble": "Overview",
    "FC moyenne": "Avg HR",
    "FC repos": "Resting HR",
    "Calories actives": "Active calories",
    "Pas": "Steps",
    "Intensité (minutes)": "Intensity (minutes)",
    "Stress": "Stress",
    "Sommeil (h)": "Sleep (h)",
    "Profil d'activité": "Activity profile",
    
    # Training detail
    "Retour de séance": "Session feedback",
    "Enregistrer": "Save",
    "RPE": "RPE",
    "RPE global": "Overall RPE",
    "RPE cardio": "Cardio RPE",
    "RPE musculaire": "Muscular RPE",
    "RPE technique": "Technical RPE",
    "Retour d'activité": "Activity feedback",
    "Retour d'activité enregistré.": "Activity feedback saved.",
    
    # RPE hints
    "Repos": "Rest",
    "Modéré": "Moderate",
    "Maximum": "Maximum",
    "Aucun effort": "No effort",
    "Très facile": "Very easy",
    "Facile": "Easy",
    "Léger": "Light",
    "Un peu difficile": "Somewhat hard",
    "Moyennement difficile": "Moderately hard",
    "Difficile": "Hard",
    "Très difficile": "Very hard",
    "Extrêmement difficile": "Extremely hard",
    "Presque maximum": "Near maximum",
    "Effort maximum": "Maximum effort",
    "Repos complet": "Complete rest",
    "Conversation facile": "Easy conversation",
    "Respiration calme": "Calm breathing",
    "Léger essoufflement": "Slight breathlessness",
    "Respiration plus profonde": "Deeper breathing",
    "Conversation difficile": "Difficult conversation",
    "Essoufflement marqué": "Marked breathlessness",
    "Respiration très laborieuse": "Very labored breathing",
    "Haletant": "Panting",
    "À bout de souffle": "Out of breath",
    "Limite cardiovasculaire": "Cardiovascular limit",
    "Aucune fatigue": "No fatigue",
    "Muscles frais": "Fresh muscles",
    "Légère sensation": "Slight sensation",
    "Muscles sollicités": "Muscles engaged",
    "Début de fatigue": "Beginning fatigue",
    "Fatigue modérée": "Moderate fatigue",
    "Muscles fatigués": "Tired muscles",
    "Fatigue importante": "Significant fatigue",
    "Muscles très fatigués": "Very tired muscles",
    "Épuisement musculaire": "Muscular exhaustion",
    "Limite musculaire": "Muscular limit",
    "Aucune difficulté": "No difficulty",
    "Très fluide": "Very smooth",
    "Bonne aisance": "Good ease",
    "Quelques imprécisions": "Some imprecision",
    "Technique correcte": "Correct technique",
    "Erreurs occasionnelles": "Occasional errors",
    "Technique dégradée": "Degraded technique",
    "Difficultés marquées": "Marked difficulties",
    "Technique très dégradée": "Very degraded technique",
    "Gestes désordonnés": "Disorganized movements",
    "Perte de coordination": "Loss of coordination",

    # Competition detail  
    "Activités Garmin associées": "Associated Garmin activities",
    "Même jour et même sport.": "Same day and sport.",
    
    # Flash messages (most common)
    "Veuillez vous connecter à Garmin.": "Please sign in to Garmin.",
    "Accès administrateur requis.": "Administrator access required.",
    "Utilisateur invalide.": "Invalid user.",
    "Accès refusé (coach requis + athlète ajouté).": "Access denied (coach required + athlete added).",
    "Accès coach requis.": "Coach access required.",
    "Impossible de t'ajouter toi-même.": "Cannot add yourself.",
    "Impossible d'ajouter l'athlète.": "Cannot add athlete.",
    "Athlète ajouté: {target}": "Athlete added: {target}",
    "Impossible de retirer l'athlète.": "Cannot remove athlete.",
    "Athlète retiré: {target}": "Athlete removed: {target}",
    "Rôle coach mis à jour pour {target}: {status}": "Coach role updated for {target}: {status}",
    "ON": "ON",
    "OFF": "OFF",
    "Échec de la mise à jour du rôle coach.": "Failed to update coach role.",
    "PIN réinitialisé pour {target}: {pin}": "PIN reset for {target}: {pin}",
    "Échec de la réinitialisation du PIN.": "Failed to reset PIN.",
    "Email et PIN requis (4 à 12 chiffres).": "Email and PIN required (4 to 12 digits).",
    "Identifiants invalides.": "Invalid credentials.",
    "Connecté en tant que {user}. La synchro Garmin se fera lors de la mise à jour (Activités / Santé).": "Signed in as {user}. Garmin sync will occur when updating (Activities / Health).",
    "Pseudo requis (2 à 80 caractères).": "Username required (2 to 80 characters).",
    "Compte déjà existant. Connecte-toi.": "Account already exists. Sign in.",
    "Pseudo déjà utilisé. Choisis-en un autre.": "Username already taken. Choose another.",
    "Création du compte impossible. Vérifie la base de données.": "Account creation failed. Check the database.",
    "Déconnecté.": "Signed out.",
    "Accès refusé.": "Access denied.",
    "Compétition ajoutée.": "Race added.",
    "Nom et date sont obligatoires.": "Name and date are required.",
    "Compétition introuvable.": "Race not found.",
    "Compétition supprimée.": "Race deleted.",
    "Entraînement ajouté.": "Training added.",
    "Titre et date sont obligatoires.": "Title and date are required.",
    "Entraînement introuvable.": "Training not found.",
    "Entraînement supprimé.": "Training deleted.",
    "Retour de séance enregistré.": "Session feedback saved.",
    "FC max invalide.": "Invalid max HR.",
    "Zones invalides: il faut 0 < Z1 < Z2 < Z3 < Z4 < FC max.": "Invalid zones: must have 0 < Z1 < Z2 < Z3 < Z4 < max HR.",
    "Profil enregistré.": "Profile saved.",
    
    # Common
    "Afficher": "Show",
    "Total": "Total",
    
    # Activity page translations
    "Activités": "Activities",
    "Synchroniser": "Sync",
    "Aucune activité.": "No activities.",
    "Filtre type": "Type filter",
    "Tous les types": "All types",
    "Recherche": "Search",
    "Nom ou date": "Name or date",
    "Mot de passe Garmin": "Garmin password",
    "Mettre à jour": "Update",
    "Mise à jour en cours": "Update in progress",
    "Natation • Vélo • Course à pied • Musculation": "Swimming • Cycling • Running • Strength",
    "Aucune activité disponible. Clique sur \"Mettre à jour\".": "No activities available. Click \"Update\".",
    "Graphiques indisponibles": "Charts unavailable",
    "Synchronise pour générer les graphes.": "Sync to generate charts.",
    "Planifié": "Planned",
    "Voir séance": "View session",
    "Aucune activité pour ce sport sur la période.": "No activities for this sport in the period.",
    
    # Activity detail translations
    "Détail activité": "Activity detail",
    "Retour aux activités": "Back to activities",
    "Retour": "Back",
    "Activité": "Activity",
    "Carte": "Map",
    "Statistiques": "Statistics",
    "Tours": "Laps",
    "Durée": "Duration",
    "Allure": "Pace",
    "Vitesse": "Speed",
    "Vitesse moyenne": "Average speed",
    "Allure moyenne": "Average pace",
    "Fréquence cardiaque moyenne": "Average heart rate",
    "Fréquence cardiaque max": "Max heart rate",
    "Dénivelé positif": "Elevation gain",
    "Dénivelé négatif": "Elevation loss",
    "Cadence moyenne": "Average cadence",
    "Puissance moyenne": "Average power",
    "Puissance normalisée": "Normalized power",
    "Calories": "Calories",
    "Temperature moyenne": "Average temperature",
    "Voir sur Garmin Connect": "View on Garmin Connect",
    "Résumé": "Summary",
    "Sport": "Sport",
    "Date": "Date",
    "Distance": "Distance",
    "FC moyenne": "Avg HR",
    "FC max": "Max HR",
    "D+ / D-": "Elev +/-",
    "Données": "Data",
    "Qualité des données": "Data quality",
    "GPS": "GPS",
    "Oui": "Yes",
    "Non / inconnu": "No / unknown",
    "Points": "Points",
    "Mesures": "Metrics",
    "Mesures disponibles": "Available metrics",
    "Planifier": "Plan",
    "Créer un entraînement planifié à partir de cette activité.": "Create a planned training from this activity.",
    "Planifier à partir de cette séance": "Plan from this session",
    "Entraînement planifié": "Planned training",
    "Séance programmée le même jour pour ce sport.": "Session scheduled on the same day for this sport.",
    "Voir la fiche": "View details",
    "Remarques": "Notes",
    "Courbes calculées depuis les métriques de l'activité.": "Charts computed from activity metrics.",
    "Trace GPS (si disponible).": "GPS track (if available).",
    "Entraînement": "Training",
    "effets, charge…": "effects, load…",
    "temps passé": "time spent",
    "Tours (laps)": "Laps",
    "FC moy.": "Avg HR",
    "PWR": "PWR",
    "Cadence": "Cadence",
    "kcal": "kcal",
    "Type": "Type",
    "Splits Garmin": "Garmin Splits",
    "Détails Garmin": "Garmin Details",
    "JSON brut": "raw JSON",
    "Détails indisponibles": "Details unavailable",
    "Clique sur \"Mettre à jour\" dans la page Activités pour synchroniser les détails.": "Click \"Update\" on the Activities page to sync details.",
    
    # Health page translations
    "Santé": "Health",
    "Poids": "Weight",
    "Masse grasse": "Body fat",
    "Masse musculaire": "Muscle mass",
    "Hydratation": "Hydration",
    "Masse osseuse": "Bone mass",
    "IMC": "BMI",
    "Sommeil": "Sleep",
    "Stress": "Stress",
    "VO2 Max": "VO2 Max",
    "Pas": "Steps",
    "Fréquence cardiaque au repos": "Resting heart rate",
    "Clique sur \"Mettre à jour\" pour synchroniser ta santé.": "Click \"Update\" to sync your health data.",
    
    # Tracking page translations
    "Suivi": "Tracking",
    "Aucune donnée de suivi.": "No tracking data.",
}


def translate(lang: str | None, text: str, **kwargs: Any) -> str:
    """Translate a UI string.

    Args:
        lang: 'fr' or 'en' (anything else falls back to 'fr').
        text: source (French) string.
        kwargs: optional format args applied after translation.

    Returns:
        Translated text when available, else original text.
    """

    lang_norm = (lang or "fr").strip().lower()
    out = text
    if lang_norm.startswith("en"):
        out = _TRANSLATIONS_EN.get(text, text)

    if kwargs:
        try:
            out = out.format(**kwargs)
        except Exception:
            # If formatting fails, return the raw string.
            pass

    return out
